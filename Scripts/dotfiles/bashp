#!/bin/bash

# Amazing Bash Profile

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[0;37m'
RESET='\033[0m'

# Git branch function
git_branch() {
    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/ (\1)/'
}

# Get OS version
get_os_version() {
    if [ -f /etc/os-release ]; then
        . /etc/os-release
        echo $PRETTY_NAME
    elif [ -f /etc/redhat-release ]; then
        cat /etc/redhat-release
    else
        echo "Unknown OS"
    fi
}

# Set amazing prompt
set_amazing_prompt() {
    PS1="\n${MAGENTA}┌─[${CYAN}\u${MAGENTA}]${WHITE}@${GREEN}\h ${YELLOW}in ${RED}\w${CYAN}\$(git_branch)\n"
    PS1+="${MAGENTA}└─╼ ${GREEN}\$(get_os_version) ${WHITE}$ ${RESET}"
}

set_amazing_prompt

# Useful aliases
alias ll='ls -lah'
alias la='ls -A'
alias l='ls -CF'
alias update='sudo dnf update -y'
alias ports='netstat -tulanp'
alias meminfo='free -m -l -t'
alias psmem='ps auxf | sort -nr -k 4 | head -10'
alias pscpu='ps auxf | sort -nr -k 3 | head -10'
alias gpumeminfo='grep -i --color memory /var/log/Xorg.0.log'

# Extract function - easily extract compressed files
extract() {
    if [ -f $1 ] ; then
        case $1 in
            *.tar.bz2)   tar xjf $1     ;;
            *.tar.gz)    tar xzf $1     ;;
            *.bz2)       bunzip2 $1     ;;
            *.rar)       unrar e $1     ;;
            *.gz)        gunzip $1      ;;
            *.tar)       tar xf $1      ;;
            *.tbz2)      tar xjf $1     ;;
            *.tgz)       tar xzf $1     ;;
            *.zip)       unzip $1       ;;
            *.Z)         uncompress $1  ;;
            *.7z)        7z x $1        ;;
            *)           echo "'$1' cannot be extracted via extract()" ;;
        esac
    else
        echo "'$1' is not a valid file"
    fi
}

# Mkdir and cd into it
mcd() {
    mkdir -p "$1" && cd "$1"
}

# Find a file with a pattern in name
function ff() { find . -type f -iname '*'"$*"'*' -ls ; }

# Create a Python virtual environment
mkvenv() {
    python3 -m venv .venv && source .venv/bin/activate
}

# Weather forecast
weather() {
    curl "wttr.in/$1"
}

# Git log with color and branch graph
alias glog="git log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"

# Add color to man pages
man() {
    env \
    LESS_TERMCAP_mb=$(printf "\e[1;31m") \
    LESS_TERMCAP_md=$(printf "\e[1;31m") \
    LESS_TERMCAP_me=$(printf "\e[0m") \
    LESS_TERMCAP_se=$(printf "\e[0m") \
    LESS_TERMCAP_so=$(printf "\e[1;44;33m") \
    LESS_TERMCAP_ue=$(printf "\e[0m") \
    LESS_TERMCAP_us=$(printf "\e[1;32m") \
    man "$@"
}

# Set some environment variables
export EDITOR="vim"
export VISUAL="vim"
export HISTCONTROL=ignoreboth:erasedups
export HISTSIZE=10000
export HISTFILESIZE=10000

# Enable programmable completion features
if ! shopt -oq posix; then
  if [ -f /usr/share/bash-completion/bash_completion ]; then
    . /usr/share/bash-completion/bash_completion
  elif [ -f /etc/bash_completion ]; then
    . /etc/bash_completion
  fi
fi

# Source local customizations
if [ -f ~/.bash_local ]; then
    source ~/.bash_local
fi

# Welcome message
echo -e "${GREEN}Welcome, ${CYAN}$USER${GREEN}! You're using ${YELLOW}$(get_os_version)${GREEN}."
echo -e "Today is ${CYAN}$(date '+%A, %B %d, %Y')${GREEN}. The time is ${CYAN}$(date '+%H:%M:%S')${GREEN}."
echo -e "Your working directory is ${YELLOW}$PWD${RESET}"
echo -e "${MAGENTA}Happy coding!${RESET}\n"
